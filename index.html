
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio File Utility</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Removed Material Symbols font—using inline SVG icons instead -->
    <style>
        /* Global Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        input[type="text"], textarea {
            background-color: #333333;
            border: none;
            color: #e0e0e0;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            outline: none;
        }
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #666666;
            border-radius: 0.25rem;
            background-color: #333333;
            cursor: pointer;
            position: relative;
            vertical-align: middle;
        }
        input[type="checkbox"]:checked {
            background-color: #666666;
            border-color: #666666;
        }
        input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 2px;
        }
        .control-button {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #666666;
            border-radius: 0.25rem;
            background-color: #333333;
            cursor: pointer;
            position: relative;
            vertical-align: middle;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .control-button:hover {
            background-color: #444444;
        }
        .transpose-icon {
            width: 0.75rem;
            height: 0.75rem;
            background-color: #e0e0e0;
        }
        .arrow-up {
            -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8l-6 6h12l-6-6z"/></svg>') no-repeat center;
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8l-6 6h12l-6-6z"/></svg>') no-repeat center;
        }
        .arrow-down {
            -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 16l6-6H6l6 6z"/></svg>') no-repeat center;
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 16l6-6H6l6 6z"/></svg>') no-repeat center;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: border-color 0.3s ease;
            color: #888;
            font-weight: 500;
        }
        .tab-button:hover {
            color: #e0e0e0;
        }
        .tab-button.active {
            color: #e0e0e0;
            border-bottom-color: #3b82f6;
        }
        .tab-content {
            width: 100%;
            position: relative;
        }
        .flex.justify-end.space-x-2.mb-2 {
            margin-bottom: 0.5rem;
            gap: 0.5rem;
        }
        .tab-pane.active {
            display: block;
            margin-top: 1rem;
        }
        .hidden { display: none; }
        /* Creator-specific */
        #tab-creator input[type="text"] {
            margin-bottom: 1rem;
            margin-top: 0.5rem;
        }
        /* Converter-specific */
        #tab-converter textarea#input {
            margin-bottom: 1rem;
            margin-top: 0.5rem;
        }
        #tab-converter #output {
            background-color: #333333;
            color: #e0e0e0;
            overflow-y: auto;
            margin-top: 0.5rem;
        }
        .action-button {
            width: 2rem;
            height: 2rem;
            background-color: #333333;
            border: 1px solid #666666;
            border-radius: 0.375rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            color: #e0e0e0;
        }
        .action-button:hover { background-color: #444444; }
        .action-button:active { background-color: #555555; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-2xl flex flex-col items-center space-y-6">
        <!-- New H1 Header -->
        <h1 class="text-3xl font-bold text-white mb-2">Audio File Utility</h1>
        
        <!-- Tab Navigation -->
        <div class="flex space-x-4 mb-4">
            <button class="tab-button active" data-tab="tab-creator">Audio File Name Creator</button>
            <button class="tab-button" data-tab="tab-converter">Audio File Name Convertor</button>
        </div>
        <!-- Tab Content -->
        <div class="tab-content w-full">
            <div class="flex justify-end space-x-2 mb-2">
                <button id="copyButton" class="action-button" title="Copy to clipboard">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                    </svg>
                </button>
                <button id="downloadButton" class="action-button" title="Download as file">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                </button>
            </div>
            <div id="tab-creator" class="tab-pane active">
                <input
                    type="text"
                    id="inputField"
                    placeholder="Enter Note Range & Base Name"
                    class="w-full rounded-lg px-4 py-3 text-lg focus:ring-2 focus:ring-blue-500"
                />
                <textarea
                    id="preview"
                    readonly
                    class="w-full h-64 rounded-lg p-4 text-base resize-none focus:ring-2 focus:ring-blue-500"
                ></textarea>
                <div class="w-full text-center">
                    <div class="flex items-center justify-center space-x-6 w-full">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="toggleUnderscore" class="rounded-md" />
                            <span class="ml-2 text-base">Toggle</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="enharmonicShift" class="rounded-md" />
                            <span class="ml-2 text-base">Enharmonic Shift</span>
                        </label>
                        <div class="flex items-center space-x-2">
                            <span class="text-base mr-2">Transpose</span>
                            <button id="octaveUp" class="control-button">
                                <div class="transpose-icon arrow-up"></div>
                            </button>
                            <button id="octaveDown" class="control-button">
                                <div class="transpose-icon arrow-down"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-converter" class="tab-pane hidden">
                <textarea
                    id="input"
                    placeholder="Paste Existing Audio File Name"
                    class="w-full h-64 rounded-lg p-4 text-base resize-none focus:ring-2 focus:ring-blue-500"
                ></textarea>
                <pre
                    id="output"
                    class="w-full h-64 rounded-lg p-4 text-base bg-gray-800 overflow-auto"
                ></pre>
            </div>
        </div>
        <div id="status" class="text-sm text-gray-500 text-center"></div>
    </div>

    <script>
        class TabManager {
            constructor() {
                this.tabButtons = null;
                this.tabPanes = null;
            }
            init() {
                this.tabButtons = document.querySelectorAll('.tab-button');
                this.tabPanes = document.querySelectorAll('.tab-pane');
                this.bindEvents();
            }
            switchTab(targetTabId) {
                this.tabButtons.forEach(btn => btn.classList.remove('active'));
                this.tabPanes.forEach(pane => {
                    pane.classList.remove('active', 'hidden');
                    pane.classList.add('hidden');
                });
                const btn = document.querySelector(`[data-tab="${targetTabId}"]`);
                const pane = document.getElementById(targetTabId);
                if (btn) btn.classList.add('active');
                if (pane) {
                    pane.classList.remove('hidden');
                    pane.classList.add('active');
                }
            }
            bindEvents() {
                this.tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        this.switchTab(button.dataset.tab);
                    });
                });
            }
        }

        class AudioCreator {
            constructor() {
                this.SHARP_NOTES = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
                this.FLAT_NOTES = ['C','Db','D','Eb','E','F','Gb','G','Ab','A','Bb','B'];
                this.octaveOffset = 0;
                this.useUnderscore = false;
            }
            init() {
                this.bindEvents();
                this.generatePreview();
            }
            noteToMIDI(note) {
                const m = note.match(/([A-G][#b]?)(-?\d+)/);
                if (!m) return null;
                const [, name, oct] = m;
                let idx = this.SHARP_NOTES.indexOf(name);
                if (idx === -1) idx = this.FLAT_NOTES.indexOf(name);
                if (idx === -1) return null;
                return (parseInt(oct)+1)*12 + idx;
            }
            midiToNote(m, useFlats=false) {
                const o = Math.floor((m-12)/12);
                const idx = (((m-12)%12)+12)%12;
                const n = useFlats ? this.FLAT_NOTES[idx] : this.SHARP_NOTES[idx];
                return `${n}${o}`;
            }
            parseInput(i) {
                const orig = i;
                const rangeMatch = orig.match(/([A-G][#B]?)(-?\d+)-([A-G][#B]?)(-?\d+)/i);
                if (!rangeMatch) return {start:null,end:null,baseName:''};
                const [, sN, sO, eN, eO] = rangeMatch;
                const start = sN.toUpperCase() + sO;
                const end = eN.toUpperCase() + eO;
                const baseName = orig.substring(rangeMatch.index + rangeMatch[0].length).trim();
                return { start, end, baseName };
            }
            generatePreview() {
                const txt = document.getElementById('inputField').value;
                const {start,end,baseName} = this.parseInput(txt);
                const p = document.getElementById('preview');
                if (!txt.trim()||!start||!end) { p.textContent=''; return; }
                const s = this.noteToMIDI(start);
                const e = this.noteToMIDI(end);
                if (s===null||e===null||s>e) { p.textContent=''; return; }
                const off = this.octaveOffset*12;
                const out=[];
                const separator = this.useUnderscore ? '_' : '-';
                for (let m=s+off; m<=e+off; m++){
                    const useF = document.getElementById('enharmonicShift').checked;
                    const note = this.midiToNote(m,useF);
                    out.push(`${String(m).padStart(2,'0')}${separator}${note}${separator}${baseName}`);
                }
                p.textContent = out.join('\n');
            }
            bindEvents() {
                const status = document.getElementById('status');
                document.getElementById('enharmonicShift').addEventListener('change',()=>this.generatePreview());
                document.getElementById('toggleUnderscore').addEventListener('change',()=>{
                    this.useUnderscore = document.getElementById('toggleUnderscore').checked;
                    this.generatePreview();
                });
                document.getElementById('octaveUp').addEventListener('click',()=>{this.octaveOffset++;this.generatePreview();});
                document.getElementById('octaveDown').addEventListener('click',()=>{this.octaveOffset--;this.generatePreview();});
                document.getElementById('inputField').addEventListener('input',()=>{
                    const txt = document.getElementById('inputField').value;
                    const {start,end} = this.parseInput(txt);
                    if (!txt.trim()) status.textContent = '';
                    else if (!start||!end) status.innerHTML = 'Enter Note Range and Audio File Name<br>C3-C4 Electric_Bass_RR1';
                    else status.textContent = '';
                    this.generatePreview();
                });
            }
        }

        class AudioConverter {
            constructor() { this.debounceTimer = null; }
            init() { this.bindEvents(); }
            debounce(fn, d) {
                return (...a)=>{ clearTimeout(this.debounceTimer); this.debounceTimer = setTimeout(()=>fn.apply(this,a), d); };
            }
            processFilenames(lines) {
                let counter = 76;
                const mapNo = new Map();
                const mapRR = new Map();
                const res = [];
                const rx = /-([A-G]#?\d)-V/;
                lines.forEach(fn=>{
                    fn = fn.trim();
                    if (!fn) return;
                    const ext = fn.endsWith('.aif')?'.aif':fn.endsWith('.wav')?'.wav':fn.endsWith('.mp3')?'.mp3':'';
                    const base = ext?fn.slice(0,-ext.length):fn;
                    const m = base.match(rx);
                    if (!m) { res.push(`# ERROR: Note not found — ${fn}`); return; }
                    const note = m[1];
                    if (!mapNo.has(note)) { mapNo.set(note,counter--); }
                    const pre = mapNo.get(note);
                    const rrCnt = mapRR.get(note)||0;
                    const rrLab = (rrCnt % 2===0)?'RR1':'RR2';
                    mapRR.set(note, rrCnt+1);
                    const updated = base.replace(/-RR1-/,`-${rrLab}-`);
                    res.push(`${pre}_${updated}`);
                });
                return res;
            }
            updateOutput() {
                const text = document.getElementById('input').value.split('\n');
                const out = this.processFilenames(text);
                document.getElementById('output').textContent = out.join('\n');
            }
            bindEvents() {
                document.getElementById('input').addEventListener('input', this.debounce(()=>this.updateOutput(),300));
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const creator = new AudioCreator();
            const converter = new AudioConverter();
            const tabs = new TabManager();
            creator.init();
            converter.init();
            tabs.init();

            const dlBtn = document.getElementById('downloadButton');
            const cpBtn = document.getElementById('copyButton');
            dlBtn.addEventListener('click', () => {
                const active = document.querySelector('.tab-pane.active');
                let content = '', fname = '';
                if (active.id==='tab-creator') {
                    content = document.getElementById('preview').textContent;
                    fname = 'audio-files.txt';
                } else {
                    content = document.getElementById('output').textContent;
                    fname = 'converted-audio-files.txt';
                }
                if (content.trim()) {
                    const blob = new Blob([content],{type:'text/plain'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = fname; a.click();
                    URL.revokeObjectURL(url);
                }
            });
            cpBtn.addEventListener('click', () => {
                const active = document.querySelector('.tab-pane.active');
                let content = '';
                if (active.id==='tab-creator') content = document.getElementById('preview').textContent;
                else content = document.getElementById('output').textContent;
                if (content.trim()) {
                    navigator.clipboard.writeText(content).then(()=>{
                        const status = document.getElementById('status');
                        status.textContent = 'Copied to clipboard!';
                        setTimeout(()=>status.textContent='',2000);
                    });
                }
            });
        });
    </script>
</body>
</html>
